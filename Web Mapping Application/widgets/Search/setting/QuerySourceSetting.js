//>>built
require({cache:{"url:widgets/Search/setting/QuerySourceSetting.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"source-tips jimu-ellipsis" title\x3d"${nls.searchLayerTips}" data-dojo-attach-point\x3d"tipsNode"\x3e\r\n    \x3cem\x3e${nls.searchLayerTips}\x3c/em\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"source-url-section"\x3e\r\n    \x3ctable class\x3d"source-table"\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.layerSource}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"sourceUrl" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true,disabled:true,style:{width:\'100%\'}"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"third"\x3e\r\n          \x3cspan class\x3d"jimu-btn" data-dojo-attach-event\x3d"click:_onSetSourceClick"\x3e${nls.set}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"source-details-section"\x3e\r\n    \x3ctable class\x3d"source-table"\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.name}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"sourceName" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true,required:true,style:{width:\'100%\'}"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.placeholder}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"placeholder" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true,style:{width:\'100%\'}"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.searchFields}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv class\x3d"search-fields"\x3e\r\n            \x3c!-- \x3cspan class\x3d"fields jimu-float-leading" data-dojo-attach-point\x3d"fieldsNode"\x3e\x3c/span\x3e --\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"searchFields" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true,disabled:true,style:{width:\'95%\'}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"search-fields-selector jimu-float-trailing" data-dojo-attach-point\x3d"fieldsSelectorNode" data-dojo-attach-event\x3d"click:_onFieldsSelectorClick"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.displayField}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"displayField" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d\'style:{width:"100%"}\'\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.exactMatch}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"exactMatch" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-props\x3d"checked:false"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"first"\x3e\r\n          \x3cspan class\x3d"source-label"\x3e${nls.maxResults}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"second"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"maxResults" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"constraints:{min:1,places:0},style:{width:\'100%\'}"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./QuerySourceSetting.html dojo/_base/lang dojo/_base/array dojo/on dojo/query dojo/Deferred dojo/Evented jimu/dijit/_FeaturelayerSourcePopup esri/request jimu/dijit/Popup jimu/dijit/CheckBox jimu/dijit/LoadingShelter dijit/form/ValidationTextBox dojo/NodeList-data".split(" "),function(l,e,m,n,p,q,c,f,k,g,r,s,t,u,v,w){return l([m,n,p,s],{baseClass:"jimu-widget-search-query-source-setting",
templateString:q,nls:null,appConfig:null,map:null,tr:null,config:null,fieldsPopup:null,_layerDefinition:null,_fieldsCheckBox:null,_layerId:null,_suggestible:!1,postCreate:function(){this._layerDefinition={};this._fieldsCheckBox=[]},setDefinition:function(a){this._layerDefinition=a||{}},getDefinition:function(){return this._layerDefinition},setRelatedTr:function(a){this.tr=a},getRelatedTr:function(){return this.tr},setConfig:function(a){if("[object Object]"===Object.prototype.toString.call(a)){var b=
a.url;b&&(this.config=a,this.shelter.show(),this._layerDefinition.url!==b?this._getDefinitionFromRemote(b).then(c.hitch(this,function(a){a&&(this._layerDefinition=a,this._layerDefinition.url=b,this._setSourceItems());this.shelter.hide()})):(this._setSourceItems(),this.shelter.hide()))}},isValidConfig:function(){var a=this.getConfig();return a.url&&a.name&&a.displayField?!0:!1},showValidationTip:function(){this._showValidationErrorTip(this.sourceUrl);this._showValidationErrorTip(this.sourceName)},
getConfig:function(){return{layerId:this._layerId,url:this.sourceUrl.get("value"),name:this.sourceName.get("value"),placeholder:this.placeholder.get("value"),searchFields:this._getSearchFields(),displayField:this.displayField.get("value"),exactMatch:this.exactMatch.getValue(),maxResults:this.maxResults.get("value"),type:"query"}},destroy:function(){this.inherited(arguments);this.fieldsPopup&&(this.fieldsPopup.close(),this.fieldsPopup=null);this.tr=this.nls=this.config=this._layerDefinition=null},
_setSourceItems:function(){this.sourceUrl.set("value",this.config.url);this.sourceName.set("value",this.config.name||"");this.placeholder.set("value",this.config.placeholder||"");this._setSearchFields2Node();this.searchFields.set("value",this._getSearchFieldsAlias());this._setDisplayFieldOptions();this.displayField.set("value",this.config.displayField||"");this.exactMatch.setValue(!!this.config.exactMatch);this.maxResults.set("value",this.config.maxResults);this._layerId=this.config.layerId;(this._suggestible=
this._layerDefinition&&this._layerDefinition.advancedQueryCapabilities&&this._layerDefinition.advancedQueryCapabilities.supportsPagination)?this._hideSuggestibleTips():this._showSuggestibleTips()},_getDefinitionFromRemote:function(a){var b=new r;a=u({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});this.own(a);a.then(c.hitch(this,function(a){b.resolve(a)}),c.hitch(this,function(a){console.error(a);b.resolve(null)}));return b.promise},_setSearchFields2Node:function(){var a=null,
b=this._layerDefinition&&this._layerDefinition.fields&&0<this._layerDefinition.fields.length;if(!this.config||!(this.config.searchFields&&0<this.config.searchFields.length))a=[];if(b)var h=this._layerDefinition.fields,a=f.filter(this.config.searchFields,function(a){return f.some(h,function(b){return b.name===a})});else a=this.config.searchFields;this.searchFields.set("_fields",a)},_setDisplayFieldOptions:function(){var a=[];this._layerDefinition&&(this._layerDefinition.fields&&0<this._layerDefinition.fields.length)&&
(a=f.map(this._layerDefinition.fields,function(a){return{label:a.alias||a.name||"",value:a.name||""}}));this.displayField.set("options",a)},_getSearchFieldsAlias:function(){var a=this._getSearchFields();if(!(a&&0<a.length))return"";if(!this._layerDefinition||!(this._layerDefinition.fields&&0<this._layerDefinition.fields.length))return a.join(",");for(var b=this._layerDefinition.fields,h=f.map(b,function(a){return a&&a.name}),c=[],d=0,e=a.length;d<e;d++){var g=h.indexOf(a[d]);-1<g&&c.push(b[g].alias)}return c.join(",")},
_getSearchFields:function(){return this.searchFields.get("_fields")},_setSearchFields:function(a){this.searchFields.set("_fields",a)},_onSetSourceClick:function(){var a=new t({titleLabel:this.nls.setLayerSource,dijitArgs:{multiple:!1,createMapResponse:this.map.webMapResponse,portalUrl:this.appConfig.portalUrl,style:{height:"100%"}}});k.once(a,"ok",c.hitch(this,function(b){a.close();this.setDefinition(b.definition||{});this.setConfig({layerId:b.layerInfo&&b.layerInfo.id||null,url:b.url,name:b.name||
"",placeholder:"",searchFields:[],displayField:this._layerDefinition.displayField||"",exactMatch:!1,maxResults:6,type:"query"});a=null;this.emit("reset-query-source",b)}));k.once(a,"cancel",c.hitch(this,function(){a.close();a=null}))},_onFieldsSelectorClick:function(){var a=e.create("div",{style:{maxHeight:"480px"}}),b=this._layerDefinition.fields;this._fieldsCheckBox=[];f.forEach(b,c.hitch(this,function(b,c){var d=new w({checked:this._isSearchable(b),label:b.alias||b.name});e.addClass(d.domNode,
"fields-checkbox");e.addClass(d.labelNode,"jimu-ellipsis");e.setAttr(d.domNode,{title:b.alias||b.name});0===c%3&&(window.isRTL?e.setStyle(d.domNode,"marginRight",0):e.setStyle(d.domNode,"marginLeft",0));d.placeAt(a);g(d.domNode).data("fieldName",b.name);this._fieldsCheckBox.push(d)}));this.fieldsPopup=new v({titleLabel:this.nls.setSearchFields,autoHeight:!0,content:a,container:window.jimuConfig.layoutId,width:640,maxHeight:600,buttons:[{label:this.nls.ok,onClick:c.hitch(this,"_onSearchFieldsOk")},
{label:this.nls.cancel}],onClose:c.hitch(this,function(){this.fieldsPopup=null})});e.addClass(this.fieldsPopup.domNode,"jimu-widget-search-query-source-setting-fields")},_onSearchFieldsOk:function(){var a=[];f.forEach(this._fieldsCheckBox,function(b){if(b.getValue()){var c=g(b.domNode).data("fieldName");a.push(c[0]);g(b.domNode).removeData()}});this._setSearchFields(a);this.searchFields.set("value",this._getSearchFieldsAlias());this.fieldsPopup.close()},_isSearchable:function(a){var b=this._getSearchFields();
return f.some(b,c.hitch(this,function(b){return a.name===b}))},_showSuggestibleTips:function(){e.addClass(this.tipsNode,"source-tips-show")},_hideSuggestibleTips:function(){e.removeClass(this.tipsNode,"source-tips-show")},_showValidationErrorTip:function(a){if(!a.validate()&&a.domNode&&a.focusNode){var b=a.get("disabled");b&&a.set("disabled",!1);a.focusNode.focus();setTimeout(c.hitch(this,function(){a.focusNode.blur();b&&a.set("disabled",!0);a=null}),100)}}})});