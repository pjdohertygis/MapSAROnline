//>>built
define(["dojo/_base/array","dojo/Deferred","esri/request"],function(g,f,e){function h(a){var b={url:k(a),content:{f:"json"},handleAs:"json"};return e(b).then(function(a){var c={};c.currentVersion=a.currentVersion||0;c.url=b.url;c.hasResultMapServer="esriExecutionTypeAsynchronous"===a.executionType&&"resultMapServerName"in a&&""!==a.resultMapServerName;return c})}function k(a){var b=a.search(/[\w]+[^\/]*$/g);return a.substr(0,b)}function l(a){if(10.1<=a.currentVersion)return e({url:a.url+"uploads/info",
content:{f:"json"},handleAs:"json"}).then(function(a){return{supportsUpload:!0,maxUploadFileSize:a.maxUploadFileSize}},function(){return{supportsUpload:!1}});a=new f;a.resolve({supportsUpload:!1});return a}return{promisifyGetValue:function(a){var b=a.getValue;a.getValue=function(){var d=b.apply(a);if(null!==d&&d.then)return d;var c=new f;c.resolve(d);return c}},allowShareResult:function(a){return g.some(a.outputParams,function(a){return"GPRecordSet"===a.dataType||"GPFeatureRecordSetLayer"===a.dataType&&
a.defaultValue&&a.defaultValue.geometryType})},getServiceDescription:function(a){var b;return e({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(d){b=d;return h(a).then(function(a){b.serverInfo=a;b.useResultMapServer=a.hasResultMapServer;return l(a).then(function(a){b.serverInfo.supportsUpload=a.supportsUpload;"maxUploadFileSize"in a&&(b.serverInfo.maxUploadFileSize=a.maxUploadFileSize);return b})})})}}});