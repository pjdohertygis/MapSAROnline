//>>built
require({cache:{"url:widgets/Chart/setting/SingleChartSetting.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tabDiv"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"settingsTabNode"\x3e\r\n\t\t\t\x3c!--general settings--\x3e\r\n\t\t\t\x3cdiv class\x3d"part-setting-title"\x3e${nls.generalSettingsTip}\x3c/div\x3e\r\n\t\t\t\x3ctable class\x3d"part-setting-table gereral-table" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"10px;"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"116px" align\x3d"left"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"text-middle" style\x3d"vertical-align: top;"\x3e\r\n\t\t\t\t\t\t\t\x3cspan style\x3d"line-height:30px;" title\x3d"${nls.dataSource}"\x3e${nls.dataSource}\x3c/span\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3cdiv style\x3d"position:relative;overflow:hidden;width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\t\x3cdiv class\x3d"url-text-box" data-dojo-attach-point\x3d"urlTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d\'required:true,trim:true,disabled:true\' style\x3d"display:inline-block;width:380px;min-width:380px;height:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3cdiv class\x3d"filter-icon" title\x3d"${nls.addFilterTip}" data-dojo-attach-point\x3d"filterIcon"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3cdiv class\x3d"jimu-btn btn-data-source jimu-float-trailing" data-dojo-attach-point\x3d"btnSetSource" data-dojo-attach-event\x3d"onclick:_onBtnSetClicked" title\x3d"${nls.set}"\x3e${nls.set}\x3c/div\x3e\r\n\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t\t\t\t\x3cspan title\x3d"${nls.chartTitle}"\x3e${nls.chartTitle}\x3c/span\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"chartNameTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d\'required:true,trim:true\' data-dojo-attach-event\x3d"change:_onChartNameChanged" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t\t\t\t\x3cspan title\x3d"${nls.description}"\x3e${nls.description}\x3c/span\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3ctextarea data-dojo-attach-point\x3d"descriptionTA" style\x3d"width:100%;height:34px;resize:none;"\x3e\x3c/textarea\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\r\n\r\n\t\t\t\x3c!--chart mode setting--\x3e\r\n\t\t\t\x3cdiv class\x3d"part-setting-title"\x3e${nls.chartModeSettingTip}\x3c/div\x3e\r\n\t\t\t\x3ctable class\x3d"part-setting-table chart-mode-table" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"116px" align\x3d"left"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t\t\t\t\x3cspan title\x3d"${nls.chartingMode}"\x3e${nls.chartingMode}\x3c/span\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"chartModeSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onChartModeChnaged" style\x3d"width:100%;"\x3e\r\n\t\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\r\n\r\n\t\t\t\x3c!--detail setting--\x3e\r\n\t\t\t\x3cdiv class\x3d"part-setting-title" style\x3d"margin-bottom:15px;"\x3e${nls.detailsSettingTip}\x3c/div\x3e\r\n\t\t\t\x3ctable data-dojo-attach-point\x3d"detailsTable" class\x3d"part-setting-table details-table" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\t  \x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"116px" align\x3d"left"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t  \x3c/colgroup\x3e\r\n\t\t\t  \x3ctbody calss\x3d"details-tbody"\x3e\r\n\t\t\t   \x3ctr class\x3d"detail-tr category-tr count-tr"\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t  \t\t\x3cspan title\x3d"${nls.categoryField}"\x3e${nls.categoryField}\x3c/span\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\r\n\t\t\t\t  \t\t\x3cdiv style\x3d"position:relative;overflow:hidden;width:100%;height:30px;"\x3e\r\n\t\t\t\t  \t\t\t\x3cselect data-dojo-attach-point\x3d"categoryFieldSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:485px;height:100%;"\x3e\r\n\t\t\t\t  \t\t\t\x3c/select\x3e\r\n\t\t\t\t  \t\t\t\x3cdiv class\x3d"sort-icon" title\x3d"${nls.sortOrder}" data-dojo-attach-point\x3d"categorySortOrderIcon"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\t\x3c/div\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t \x3c/tr\x3e\r\n\r\n\t\t\t\t \x3ctr class\x3d"detail-tr feature-tr category-tr field-tr"\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd class\x3d"text-middle" style\x3d"vertical-align:top;"\x3e\r\n\t\t\t\t  \t\t\x3cspan style\x3d"line-height:30px;" title\x3d"${nls.valueFields}"\x3e${nls.valueFields}\x3c/span\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\r\n\t\t\t\t  \t\t\x3cdiv data-dojo-attach-point\x3d"dataFieldsDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t \x3c/tr\x3e\r\n\r\n\t\t\t\t \x3ctr class\x3d"detail-tr feature-tr"\x3e\r\n\t\t\t\t \t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t \t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t \t\t\x3cspan title\x3d"${nls.axisLabel}"\x3e${nls.axisLabel}\x3c/span\x3e\r\n\t\t\t\t \t\x3c/td\x3e\r\n\t\t\t\t \t\x3ctd\x3e\r\n\t\t\t\t \t\t\x3cdiv style\x3d"position:relative;overflow:hidden;width:100%;height:30px;"\x3e\r\n\t\t\t\t  \t\t\t\x3cselect data-dojo-attach-point\x3d"featureAxisLabelSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:485px;height:100%;"\x3e\r\n\t\t\t\t  \t\t\t\x3c/select\x3e\r\n\t\t\t\t  \t\t\t\x3cdiv class\x3d"sort-icon" title\x3d"${nls.sortOrder}" data-dojo-attach-point\x3d"featureSortOrderIcon"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\t\x3c/div\x3e\r\n\t\t\t\t \t\x3c/td\x3e\r\n\t\t\t\t \x3c/tr\x3e\r\n\r\n\t\t\t\t \x3ctr class\x3d"detail-tr category-tr"\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t  \t\t\x3cspan title\x3d"${nls.operation}"\x3e${nls.operation}\x3c/span\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\r\n\t\t\t\t  \t\t\x3cselect data-dojo-attach-point\x3d"categoryOperationSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;"\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"sum"\x3e${nls.sumOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"average"\x3e${nls.averageOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"min"\x3e${nls.minOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"max"\x3e${nls.maxOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\x3c/select\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t \x3c/tr\x3e\r\n\r\n\t\t\t\t \x3ctr class\x3d"detail-tr field-tr"\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t  \t\t\x3cspan title\x3d"${nls.operation}"\x3e${nls.operation}\x3c/span\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\r\n\t\t\t\t  \t\t\x3cselect data-dojo-attach-point\x3d"fieldOperationSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;"\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"sum"\x3e${nls.sumOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"average"\x3e${nls.averageOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"min"\x3e${nls.minOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\t\x3coption value\x3d"max"\x3e${nls.maxOption}\x3c/option\x3e\r\n\t\t\t\t  \t\t\x3c/select\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t \x3c/tr\x3e\r\n\r\n\t\t\t\t \x3ctr class\x3d"detail-tr feature-tr category-tr count-tr field-tr chart-types-tr"\x3e\r\n\t\t\t\t  \t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd class\x3d"text-middle"\x3e\r\n\t\t\t\t  \t\t\x3cspan title\x3d"${nls.chartType}"\x3e${nls.chartType}\x3c/span\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t  \t\x3ctd class\x3d"charts-td"\x3e\r\n\t\t\t\t  \t\t\x3cdiv class\x3d"jimu-trailing-margin1"\x3e\r\n\t\t\t\t  \t\t\t\x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"columnCbx" /\x3e\r\n\t\t\t\t  \t\t\t\x3clabel data-dojo-attach-point\x3d"columnLabel"\x3e${nls.column}\x3c/label\x3e\r\n\t\t\t\t  \t\t\t\x3cdiv class\x3d"edit-div" data-dojo-attach-point\x3d"columnEdit"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\t\x3c/div\x3e\r\n\r\n\t\t\t\t  \t\t\x3cdiv class\x3d"jimu-trailing-margin1"\x3e\r\n\t\t\t\t  \t\t\t\x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"pieCbx" /\x3e\r\n\t\t\t\t  \t\t\t\x3clabel data-dojo-attach-point\x3d"pieLabel"\x3e${nls.pie}\x3c/label\x3e\r\n\t\t\t\t  \t\t\t\x3cdiv class\x3d"edit-div" data-dojo-attach-point\x3d"pieEdit"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\t\x3c/div\x3e\r\n\r\n\t\t\t\t  \t\t\x3cdiv class\x3d"jimu-trailing-margin1"\x3e\r\n\t\t\t\t  \t\t\t\x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"barCbx" /\x3e\r\n\t\t\t\t  \t\t\t\x3clabel data-dojo-attach-point\x3d"barLabel"\x3e${nls.bar}\x3c/label\x3e\r\n\t\t\t\t  \t\t\t\x3cdiv class\x3d"edit-div" data-dojo-attach-point\x3d"barEdit"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\t\x3c/div\x3e\r\n\r\n\t\t\t\t  \t\t\x3cdiv\x3e\r\n\t\t\t\t  \t\t\t\x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"lineCbx" /\x3e\r\n\t\t\t\t  \t\t\t\x3clabel data-dojo-attach-point\x3d"lineLabel"\x3e${nls.line}\x3c/label\x3e\r\n\t\t\t\t  \t\t\t\x3cdiv class\x3d"edit-div" data-dojo-attach-point\x3d"lineEdit"\x3e\x3c/div\x3e\r\n\t\t\t\t  \t\t\x3c/div\x3e\r\n\t\t\t\t  \t\x3c/td\x3e\r\n\t\t\t\t \x3c/tr\x3e\r\n\t\t\t  \x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\r\n\r\n\t\t\t\x3c!--symbol setting--\x3e\r\n\t\t\t\x3cdiv class\x3d"part-setting-title"\x3e${nls.symbolSettingTip}\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"margin-left:10px;"\x3e\r\n\t\t\t\t\x3cdiv style\x3d"margin-top:20px;overflow:hidden;"\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-float-leading symbol-tip"\x3e${nls.setSymbol}:\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"symbolPicker" data-dojo-type\x3d"jimu/dijit/SymbolPicker"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cdiv style\x3d"margin-top:30px;overflow:hidden;padding-bottom:10px;"\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-float-leading hightlight-tip"\x3e${nls.setHighLightColor}:\x3c/div\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"colorPicker" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-dojo-props\x3d\'color:"${_highLightColor}"\' style\x3d"display:inline-block;width:25px;height:25px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"previewTabNode"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"previewDiv" class\x3d"preview-div"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/query dojo/_base/Color dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Tooltip dijit/form/Select dojo/text!./SingleChartSetting.html dijit/form/ValidationTextBox dijit/TooltipDialog dijit/popup jimu/utils jimu/dijit/TabContainer3 jimu/dijit/Filter jimu/dijit/LoadingShelter jimu/dijit/_FeaturelayerSourcePopup jimu/dijit/SymbolPicker jimu/dijit/Message jimu/dijit/SimpleTable ./DataFields ../Preview ../common/Parameters esri/request esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils".split(" "),
function(r,d,k,f,h,p,g,s,t,u,v,H,I,w,J,n,q,l,x,y,K,z,L,A,M,B,C,m,D,E,F,G){return r([t,u,v,s],{baseClass:"jimu-widget-singlechart-setting",templateString:w,mediaSelector:null,config:null,map:null,nls:null,tr:null,folderUrl:"",appConfig:null,_layerDefinition:null,_highLightColor:"#ff0000",_stringFieldType:"esriFieldTypeString",_oidFieldType:"esriFieldTypeOID",_numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],postCreate:function(){this.inherited(arguments);
this._initSelf()},destroy:function(){this.tr=null;delete this.tr;this._hideAllTooltipDialogs();this._destroyTooltipDialog("filterTooltipDialog");this._destroyTooltipDialog("sortOrderTooltipDialog");this._destroyTooltipDialog("columnTTD");this._destroyTooltipDialog("barTTD");this._destroyTooltipDialog("lineTTD");this._destroyTooltipDialog("pieTTD");this.inherited(arguments)},_destroyTooltipDialog:function(a){var c=this[a];c&&(this._hideTooltipDialog(c),c.destroy());this[a]=null},_hideAllTooltipDialogs:function(){this._hideTooltipDialog(this.filterTooltipDialog);
this._hideTooltipDialog(this.sortOrderTooltipDialog);this._hideAllParamsTooltipDialogs()},_hideAllParamsTooltipDialogs:function(){this.columnTTD&&this._hideTooltipDialog(this.columnTTD);this.barTTD&&this._hideTooltipDialog(this.barTTD);this.lineTTD&&this._hideTooltipDialog(this.lineTTD);this.pieTTD&&this._hideTooltipDialog(this.pieTTD)},_hideTooltipDialog:function(a){a&&(q.close(a),a.isOpendNow=!1)},_showTooltipDialog:function(a,c,b){a&&(c={popup:a,around:c},b&&(c.orient=b),q.open(c),a.isOpendNow=
!0)},startup:function(){this._started||this.inherited(arguments);this._started=!0},_updateUrlTextBoxLength:function(){try{var a=f.getMarginBox(this.btnSetSource),c=f.getContentBox(this.descriptionTA),b=Math.max(c.w-a.w-10,380);f.setStyle(this.urlTextBox.domNode,"width",b+"px")}catch(e){console.error(e)}},setConfig:function(a){if(this._isObject(a)){this.config=a;var c=a.url||"";c&&"string"===typeof c&&(this._layerDefinition&&this._layerDefinition.url===c?this._resetByConfig(this.config,this._layerDefinition):
(this._layerDefinition=null,this.showBigShelter(),D({url:c,hanleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(d.hitch(this,function(a){this.domNode&&(this.hideBigShelter(),this._layerDefinition=a,this._layerDefinition.url=c,this._resetByConfig(this.config,this._layerDefinition))}),d.hitch(this,function(a){console.error(a);this.domNode&&this.hideBigShelter()}))))}},getConfig:function(a){var c={url:"",filter:"",name:"",description:"",mode:"",symbol:"",highLightColor:""};c.url=this.urlTextBox.get("value");
var b=this.filter.toJson();if(!b||!b.expr)return a&&(this.tab.viewStack.getSelectedLabel()!==this.nls.preview&&this._showTooltipDialog(this.filterTooltipDialog,this.urlTextBox.domNode),this._showMessage(this.nls.setFilterTip)),!1;c.filter=b;b=this.chartNameTextBox.get("value");if(!b)return a&&this._showMessage(this.nls.setChartTitleTip),!1;c.name=b;c.description=this.descriptionTA.value;c.mode=this.chartModeSelect.get("value");this.columnCbx.checked&&(c.column=this.columnParameters.getConfig());this.pieCbx.checked&&
(c.pie=this.pieParameters.getConfig());this.barCbx.checked&&(c.bar=this.barParameters.getConfig());this.lineCbx.checked&&(c.line=this.lineParameters.getConfig());if(!this.columnCbx.checked&&!this.pieCbx.checked&&!this.barCbx.checked&&!this.lineCbx.checked)return a&&this._showMessage(this.nls.setChartTypeTip),!1;if("feature"===c.mode){b={labelField:"",valueFields:[],sortOrder:""};b.labelField=this.featureAxisLabelSelect.get("value");var e=this.valueFields.getSelectedFieldNames();if(0===e.length)return a&&
this._showMessage(this.nls.setDataFieldTip),!1;b.valueFields=e;b.sortOrder=this.ascRadio.checked?"asc":"des";c=d.mixin(c,b)}else if("category"===c.mode){b={categoryField:"",operation:"",valueFields:[],sortOrder:""};b.categoryField=this.categoryFieldSelect.get("value");b.operation=this.categoryOperationSelect.get("value");e=this.valueFields.getSelectedFieldNames();if(0===e.length)return a&&this._showMessage(this.nls.setDataFieldTip),!1;b.valueFields=e;b.sortOrder=this.ascRadio.checked?"asc":"des";
c=d.mixin(c,b)}else if("count"===c.mode)a={categoryField:"",sortOrder:""},a.categoryField=this.categoryFieldSelect.get("value"),a.sortOrder=this.ascRadio.checked?"asc":"des",c=d.mixin(c,a);else if("field"===c.mode){b={operation:"",valueFields:[]};b.operation=this.fieldOperationSelect.get("value");e=this.valueFields.getSelectedFieldNames();if(0===e.length)return a&&this._showMessage(this.nls.setDataFieldTip),!1;b.valueFields=e;c=d.mixin(c,b)}this.config=d.clone(c);if(a=this.symbolPicker.getSymbol())c.symbol=
a.toJson();else return!1;a=this.colorPicker.getColor();c.highLightColor=a.toHex();this.tr._layerDefinition=this._layerDefinition;return d.clone(c)},_getBarConfig:function(){var a=null;this.barCbx.checked&&(a=this.barParameters.getConfig());return a},_getColumnConfig:function(){var a=null;this.columnCbx.checked&&(a=this.columnParameters.getConfig());return a},_getLineConfig:function(){var a=null;this.lineCbx.checked&&(a=this.lineParameters.getConfig());return a},_getPieConfig:function(){var a=null;
this.pieCbx.checked&&(a=this.pieParameters.getConfig());return a},showBigShelter:function(){this.emit("show-shelter")},hideBigShelter:function(){this.emit("hide-shelter")},_showMessage:function(a){new A({message:a})},_isObject:function(a){return a&&"object"===typeof a},_initSelf:function(){this._initTabs();this._initChartTypes();this._initFilter();this._initSortOrder();this._initDataFields();this._initPreview();this._onChartModeChnaged()},_initTabs:function(){var a={title:this.nls.preview,content:this.previewTabNode};
this.tab=new x({tabs:[{title:this.nls.settings,content:this.settingsTabNode},a]});this.tab.placeAt(this.tabDiv);this.own(g(this.tab,"tabChanged",d.hitch(this,function(c){this._hideAllTooltipDialogs();c===a.title&&this._updatePreview()})))},_initFilter:function(){var a=f.toDom('\x3cdiv\x3e\x3cdiv class\x3d"filter-div"\x3e\x3c/div\x3e\x3cdiv class\x3d"operations" style\x3d"overflow:hidden;"\x3e\x3cdiv class\x3d"jimu-btn  jimu-float-trailing btn-cancel"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-btn  jimu-float-trailing btn-ok"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'),
c=h(".filter-div",a)[0],b=h(".btn-ok",a)[0],e=h(".btn-cancel",a)[0];b.innerHTML=this.nls.ok;e.innerHTML=this.nls.close;window.isRTL?b.style.marginLeft="20px":b.style.marginRight="20px";this.filterTooltipDialog=new n({content:a});this.filter=new y;this.filter.allExpsBox.style.maxHeight="300px";this.filter.allExpsBox.style.overflowY="auto";this.filter.placeAt(c);this.filter.startup();this.own(g(b,"click",d.hitch(this,function(){this.filter.toJson()&&this._hideTooltipDialog(this.filterTooltipDialog)})));
this.own(g(e,"click",d.hitch(this,function(){this._hideTooltipDialog(this.filterTooltipDialog)})));this.own(g(this.filterIcon,"click",d.hitch(this,function(a){this.filterTooltipDialog.isOpendNow?this._hideTooltipDialog(this.filterTooltipDialog):this._showTooltipDialog(this.filterTooltipDialog,this.urlTextBox.domNode)})))},_initSortOrder:function(){var a='\x3cdiv\x3e\x3cdiv class\x3d"asc-div"\x3e\x3cinput type\x3d"radio" class\x3d"asc-radio" checked /\x3e\x3cspan class\x3d"asc-span" style\x3d"margin-left:10px;"\x3e'+
this.nls.ascending+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"des" style\x3d"margin-top:10px;"\x3e\x3cinput type\x3d"radio" class\x3d"des-radio" /\x3e\x3cspan class\x3d"des-span" style\x3d"margin-left:10px;"\x3e'+this.nls.descending+"\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e",c="chart_"+l.getRandomString(),a=f.toDom(a);this.ascRadio=h(".asc-radio",a)[0];this.desRadio=h(".des-radio",a)[0];this.ascRadio.name=c;this.desRadio.name=c;this.sortOrderTooltipDialog=new n({content:a});this.own(g(document.body,
"click",d.hitch(this,function(a){var c=!!this.sortOrderTooltipDialog.isOpendNow;this._hideTooltipDialog(this.sortOrderTooltipDialog);var d=this.chartModeSelect.get("value"),g=null;"feature"===d?g=this.featureSortOrderIcon:"category"===d&&(g=this.categorySortOrderIcon);d=a.target||a.srcElement;g&&(d===g?c?this._hideTooltipDialog(this.sortOrderTooltipDialog):this._showTooltipDialog(this.sortOrderTooltipDialog,g,["after-centered","below"]):(a=d===this.sortOrderTooltipDialog.domNode,d=f.isDescendant(d,
this.sortOrderTooltipDialog.domNode),a||d?c?this._showTooltipDialog(this.sortOrderTooltipDialog,g,["after-centered","below"]):this._hideTooltipDialog(this.sortOrderTooltipDialog):this._hideTooltipDialog(this.sortOrderTooltipDialog)))})))},_initDataFields:function(){this.valueFields=new B({nls:this.nls});this.valueFields.placeAt(this.dataFieldsDiv);this.valueFields.startup();this.own(g(this.valueFields,"change",d.hitch(this,function(){this._updateChartTypes();this._updateParametersDijit()})))},_updateParametersDijit:function(){var a=
this.chartModeSelect.get("value");"feature"===a||"category"===a?1===this.valueFields.getSelectedFieldNames().length?(this.columnParameters.showSingleColor(),this.barParameters.showSingleColor(),this.lineParameters.showSingleColor()):(this.columnParameters.showMultiColor(),this.barParameters.showMultiColor(),this.lineParameters.showMultiColor()):(this.columnParameters.showSingleColor(),this.barParameters.showSingleColor(),this.lineParameters.showSingleColor())},_updateChartTypes:function(){this.pieCbx.disabled=
!1;var a=this.chartModeSelect.get("value");if(("feature"===a||"category"===a)&&1<this.valueFields.getSelectedFieldNames().length)this.pieCbx.checked=!1,this.pieCbx.disabled=!0;this.pieCbx.disabled?f.addClass(this.pieLabel,"gray"):f.removeClass(this.pieLabel,"gray")},_initChartTypes:function(){var a=this.folderUrl+"common/images";l.combineRadioCheckBoxWithLabel(this.columnCbx,this.columnLabel);this.columnParameters=new m({type:"column",imagesUrl:a,isInWidget:!1,singleColor:!1,nls:this.nls,config:null});
this.columnTTD=this._createParametersDialog(this.columnCbx,this.columnEdit,this.columnParameters);l.combineRadioCheckBoxWithLabel(this.pieCbx,this.pieLabel);this.pieParameters=new m({type:"pie",imagesUrl:a,isInWidget:!1,singleColor:!1,nls:this.nls,config:null});this.pieTTD=this._createParametersDialog(this.pieCbx,this.pieEdit,this.pieParameters);l.combineRadioCheckBoxWithLabel(this.barCbx,this.barLabel);this.barParameters=new m({type:"bar",imagesUrl:a,isInWidget:!1,singleColor:!1,nls:this.nls,config:null});
this.barTTD=this._createParametersDialog(this.barCbx,this.barEdit,this.barParameters);l.combineRadioCheckBoxWithLabel(this.lineCbx,this.lineLabel);this.lineParameters=new m({type:"line",imagesUrl:a,isInWidget:!1,singleColor:!1,nls:this.nls,config:null});this.lineTTD=this._createParametersDialog(this.lineCbx,this.lineEdit,this.lineParameters);this.own(g(document.body,"click",d.hitch(this,function(a){var b=a.target||a.srcElement;this._unselectEditDivs();var e=null,d=a=e=null,e=b===this.columnEdit||
b===this.pieEdit||b===this.barEdit||b===this.lineEdit;b===this.columnCbx||b===this.pieCbx||b===this.barCbx||b===this.lineCbx?(e=b,e===this.columnCbx?(a=this.columnEdit,d=this.columnTTD):e===this.pieCbx?(a=this.pieEdit,d=this.pieTTD):e===this.barCbx?(a=this.barEdit,d=this.barTTD):e===this.lineCbx&&(a=this.lineEdit,d=this.lineTTD),this._hideAllParamsTooltipDialogs(),e.checked?(this._showEditDiv(a),f.addClass(a,"selected"),this._showTooltipDialog(d,a)):(this._hideTooltipDialog(d),this._hideEditDiv(a))):
e?(a=b,a===this.columnEdit?d=this.columnTTD:a===this.pieEdit?d=this.pieTTD:a===this.barEdit?d=this.barTTD:a===this.lineEdit&&(d=this.lineTTD),e=!!d.isOpendNow,this._hideAllParamsTooltipDialogs(),e?this._hideTooltipDialog(d):(this._showTooltipDialog(d,a),f.addClass(a,"selected"))):(this.columnTTD.isOpendNow?(a=this.columnEdit,d=this.columnTTD):this.pieTTD.isOpendNow?(a=this.pieEdit,d=this.pieTTD):this.barTTD.isOpendNow?(a=this.barEdit,d=this.barTTD):this.lineTTD.isOpendNow&&(a=this.lineEdit,d=this.lineTTD),
d?(e=b===d.domNode,b=f.isDescendant(b,d.domNode),e||b?(this._hideAllParamsTooltipDialogs(),this._showTooltipDialog(d,a),f.addClass(a,"selected")):this._hideAllParamsTooltipDialogs()):this._hideAllParamsTooltipDialogs())})))},_createParametersDialog:function(a,c,b){a=f.create("div");b.placeAt(a);return new n({content:a})},_unselectEditDivs:function(){f.removeClass(this.columnEdit,"selected");f.removeClass(this.pieEdit,"selected");f.removeClass(this.barEdit,"selected");f.removeClass(this.lineEdit,"selected")},
_showEditDiv:function(a){f.setStyle(a,"display","inline-block")},_hideEditDiv:function(a){f.setStyle(a,"display","none")},_initPreview:function(){this.preview=new C({nls:this.nls,folderUrl:this.folderUrl});this.preview.placeAt(this.previewDiv);this.preview.startup()},_onChartModeChnaged:function(){var a=(this.chartModeSelect.get("value")||"")+"-tr",c=h(".detail-tr",this.detailsTable);k.forEach(c,d.hitch(this,function(b){f.hasClass(b,a)?f.addClass(b,"show-tr"):f.removeClass(b,"show-tr")}));this._updateChartTypes();
this._updateParametersDijit()},_onChartNameChanged:function(){this.emit("name-change",this.chartNameTextBox.get("value"))},_onDescriptionFocus:function(){f.setStyle(this.descriptionTA,"height","62px")},_onDescriptionBlur:function(){f.setStyle(this.descriptionTA,"height","30px")},_clear:function(){this._layerDefinition=null;this.urlTextBox.set("value","");this.filter.reset();this.chartNameTextBox.set("value","");this.descriptionTA.value="";this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());
this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());this.categoryOperationSelect.set("value","sum");this.fieldOperationSelect.set("value","sum");this.valueFields.clear();this.featureAxisLabelSelect.removeOption(this.featureAxisLabelSelect.getOptions());this.ascRadio.checked=!0;this.columnCbx.checked=!1;this.pieCbx.checked=!1;this.barCbx.checked=!1;this.lineCbx.checked=!1;this.columnParameters.reset();this.pieParameters.reset();this.barParameters.reset();this.lineParameters.reset();
this.symbolPicker.reset();this.colorPicker.setColor(new p(this._highLightColor));this.preview.clear()},_onBtnSetClicked:function(){var a=new z({titleLabel:this.nls.setDataSource,dijitArgs:{multiple:!1,createMapResponse:this.map.webMapResponse,portalUrl:this.appConfig.portalUrl,style:{height:"100%"}}});this.own(g(a,"ok",d.hitch(this,function(c){a.close();this.setNewLayerDefinition(c.name,c.url,c.definition)})));this.own(g(a,"cancel",d.hitch(this,function(){a.close()})));a.startup()},_hasNumberFields:function(a){var c=
!1;(a=a.fields)&&0<a.length&&(c=k.some(a,d.hitch(this,function(a){return 0<=this._numberFieldTypes.indexOf(a.type)})));return c},setNewLayerDefinition:function(a,c,b,d){b.name=a;b.url=c;c!==(this._layerDefinition&&this._layerDefinition.url)&&this._resetByNewLayerDefinition(b,d)},_resetByNewLayerDefinition:function(a,c){this._clear();if(a){this._layerDefinition=a;var b=a.url;this.urlTextBox.set("value",b);this._layerDefinition&&this.filter.buildByExpr(b,"1\x3d1",this._layerDefinition);this.chartNameTextBox.set("value",
c||a.name);this._resetFieldsDijitsByLayerInfo(this._layerDefinition);var b=l.getTypeByGeometryType(a.geometryType),d="";"point"===b?d="marker":"polyline"===b?d="line":"polygon"===b&&(d="fill");d&&this.symbolPicker.showByType(d)}},_resetFieldsDijitsByLayerInfo:function(a){this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());this._hasNumberFields(a)?(this.chartModeSelect.addOption({value:"feature",label:this.nls.featureOption}),this.chartModeSelect.addOption({value:"category",label:this.nls.categoryOption}),
this.chartModeSelect.addOption({value:"count",label:this.nls.countOption}),this.chartModeSelect.addOption({value:"field",label:this.nls.fieldOption}),this.chartModeSelect.set("value","feature")):(this.chartModeSelect.addOption({value:"count",label:this.nls.countOption}),this.chartModeSelect.set("value","count"));var c=a.displayField;a=d.clone(a.fields);var b=[this._stringFieldType].concat(d.clone(this._numberFieldTypes)),e=k.filter(a,d.hitch(this,function(a){return 0<=b.indexOf(a.type)}));this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());
var f="";k.forEach(e,d.hitch(this,function(a){this.categoryFieldSelect.addOption({value:a.name,label:a.alias});a.name===c&&(f=c)}));this.categoryFieldSelect.set("value",f);var g=[this._stringFieldType,this._oidFieldType].concat(d.clone(this._numberFieldTypes)),e=k.filter(a,d.hitch(this,function(a){return 0<=g.indexOf(a.type)}));this.featureAxisLabelSelect.removeOption(this.featureAxisLabelSelect.getOptions());var h="";k.forEach(e,d.hitch(this,function(a){var b={value:a.name,label:a.alias};c?a.name===
c&&(h=a.name):a.type===this._oidFieldType&&(h=a.name);this.featureAxisLabelSelect.addOption(b)}));this.featureAxisLabelSelect.set("value",h);a=k.filter(a,d.hitch(this,function(a){return 0<=this._numberFieldTypes.indexOf(a.type)}));this.valueFields.setFields(a)},_resetByConfig:function(a,c){this._clear();var b=d.clone(a);this._layerDefinition=c;this.urlTextBox.set("value",b.url);this.filter.buildByFilterObj(c.url,b.filter,c);this.chartNameTextBox.set("value",b.name||c.name||"");this.descriptionTA.value=
b.description||"";this._resetFieldsDijitsByLayerInfo(c);this.chartModeSelect.set("value",b.mode);var e=d.hitch(this,function(){b.pie&&(this.pieParameters.setConfig(b.pie),this.pieCbx.checked=!0,this._showEditDiv(this.pieEdit))});"feature"===b.mode?(this.featureAxisLabelSelect.set("value",b.labelField),this.valueFields.selectFields(b.valueFields),"des"===b.sortOrder?this.desRadio.checked=!0:this.ascRadio.checked=!0,1>=b.valueFields.length&&e()):"category"===b.mode?(this.categoryFieldSelect.set("value",
b.categoryField),this.categoryOperationSelect.set("value",b.operation),this.valueFields.selectFields(b.valueFields),"des"===b.sortOrder?this.desRadio.checked=!0:this.ascRadio.checked=!0,1>=b.valueFields.length&&e()):"count"===b.mode?(this.categoryFieldSelect.set("value",b.categoryField),"des"===b.sortOrder?this.desRadio.checked=!0:this.ascRadio.checked=!0,e()):"field"===b.mode&&(this.fieldOperationSelect.set("value",b.operation),this.valueFields.selectFields(b.valueFields),e());b.column&&(this.columnParameters.setConfig(b.column),
this.columnCbx.checked=!0,this._showEditDiv(this.columnEdit));b.bar&&(this.barParameters.setConfig(b.bar),this.barCbx.checked=!0,this._showEditDiv(this.barEdit));b.line&&(this.lineParameters.setConfig(b.line),this.lineCbx.checked=!0,this._showEditDiv(this.lineEdit));e=G.fromJson(b.symbol);this.symbolPicker.showBySymbol(e);this.colorPicker.setColor(new p(b.highLightColor))},_updatePreview:function(){this.preview.clear();var a=this.getConfig(!0);if(a){var c=new E;c.returnGeometry=!1;c.where=a.filter.expr||
"1\x3d1";c.outFields=[];"feature"===a.mode?(c.outFields=d.clone(a.valueFields),0>c.outFields.indexOf(a.labelField)&&(c.outFields=[a.labelField].concat(c.outFields))):"category"===a.mode?(c.outFields=d.clone(a.valueFields),0>c.outFields.indexOf(a.categoryField)&&(c.outFields=[a.categoryField].concat(c.outFields))):"count"===a.mode?c.outFields=[a.categoryField]:"field"===a.mode&&(c.outFields=d.clone(a.valueFields));this.tab.showShelter();this.showBigShelter();(new F(a.url)).execute(c).then(d.hitch(this,
function(b){if(this.domNode){var c=f.getContentBox(this.domNode.parentNode),c=Math.max(c.h-60,150);f.setStyle(this.preview.domNode,"height",c+"px");this.preview.createCharts({config:a,featureSet:b,layerDefinition:this._layerDefinition,resultLayer:null});this.tab.hideShelter();this.hideBigShelter()}}),d.hitch(this,function(a){this.domNode&&(console.error(a),this.tab.hideShelter(),this.hideBigShelter())}))}}})});